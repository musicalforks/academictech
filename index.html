<!DOCTYPE html>
<meta charset="utf-8">
<style>

.links line {
  stroke: #999;
  stroke-opacity: 0.6;
}

.nodes circle {
  stroke: black	;
  stroke-width: 0px;
}

</style>
<svg width="960" height="600"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
//create somewhere to put the force directed graph
var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");
  
  
//characters
var nodes_data =  [
    {"name": "ecofeminism", "level": "0", "theme": "ecofeminism"/*, "x": "50", "y": "100"*/},
    {"name": "ecological education", "level": "0", "theme": "ecological education"},
    {"name": "urban planning", "level": "0", "theme": "urban planning"},
    {"name": "human rights", "level": "0", "theme": "human rights"},
    {"name": "new media", "level": "0", "theme": "new media"},
    {"name": "migration", "level": "0", "theme": "migration"},
    {"name": "group 1-edu", "level": "1", "theme": "ecological education"},
    {"name": "group 2-urb", "level": "1", "theme": "urban planning"},
    {"name": "group 3-fem", "level": "1", "theme": "ecofeminism"},
    {"name": "group 4-med-fem", "level": "1", "theme": "new media", "theme1": "ecofeminism"},
    {"name": "group 5-hum-urb", "level": "1", "theme": "human rights", "theme1": "urban planning"},
    {"name": "group 6-med", "level": "1", "theme": "new media"},
    {"name": "group 7-urb", "level": "1", "theme": "urban planning"},
    {"name": "group 8-edu-hum", "level": "1", "theme": "ecological education", "theme1": "human rights"},
    {"name": "group 9-edu", "level": "1", "theme": "ecological education"},
    {"name": "group 10-fem-edu", "level": "1", "theme": "ecofeminism", "theme1": "ecological education"},
    {"name": "group 11-mig-fem", "level": "1", "theme": "migration", "theme1": "ecofeminism"}
    ]

//Links  
var links_data = [
	{"source": "group 1-edu", "target": "ecological education", "type":"A" },
    {"source": "group 2-urb", "target": "urban planning", "type":"A" },
    {"source": "group 3-fem", "target": "ecofeminism", "type":"A"},
    {"source": "group 4-med-fem", "target": "new media", "type":"A"},
	{"source": "group 4-med-fem", "target": "ecofeminism", "type":"A"},
    {"source": "group 5-hum-urb", "target": "human rights", "type":"A"},
	{"source": "group 5-hum-urb", "target": "urban planning", "type":"A"},
    {"source": "group 6-med", "target": "new media", "type":"A"},
    {"source": "group 7-urb", "target": "urban planning", "type":"A"},
    {"source": "group 8-edu-hum", "target": "ecological education", "type":"A"},
	{"source": "group 8-edu-hum", "target": "human rights", "type":"A"},
    {"source": "group 9-edu", "target": "ecological education", "type":"A"},
    {"source": "group 10-fem-edu", "target": "ecofeminism", "type":"A"},
	{"source": "group 10-fem-edu", "target": "ecological education", "type":"A"},
    {"source": "group 11-mig-fem", "target": "migration", "type":"A"},
	{"source": "group 11-mig-fem", "target": "ecofeminism", "type":"A"}
	]
/*
	{"source": "ecofeminism", "target": "migration", "type":"B"},
	{"source": "migration", "target": "urban planning", "type":"B"},
	{"source": "urban planning", "target": "new media", "type":"B"},
	{"source": "new media", "target": "human rights", "type":"B"},
	{"source": "human rights", "target": "ecological education", "type":"B"},
	{"source": "ecological education", "target": "ecofeminism", "type":"B"},
	]*/


//set up the simulation 
var simulation = d3.forceSimulation()
					//add nodes
					.nodes(nodes_data);
                    
                    
//add forces
//we're going to add a charge to each node 
//also going to add a centering force
//and a link force
var link_force =  d3.forceLink(links_data)
                        .id(function(d) { return d.name; });
simulation
    .force("charge_force", d3.forceManyBody())
    .force("center_force", d3.forceCenter(width / 2, height / 2))
    //.force("links",link_force);
	//make force distance 80
	.force("links", link_force.distance(80).strength(0.1));

        
//add tick instructions: 
simulation.on("tick", tickActions );
simulation.on("tick", tickActions );
	

/* method 1?
var g = svg.selectAll("g.node")
  .data(nodes_data)
.enter().append("svg:g")
  .attr("class", "node")
  .attr("transform", function(d) { return "translate(450, 300)"; })
  .call(force.drag);

g.append("svg:circle")
  .attr("r", 5);

g.append("svg:text")
  .attr("x", 10)
  .attr("dy", ".31em")
  .text(function(d) { return d.name; });
  */
	

// method 2??? orig code + extra block re: text 
//draw circles for nodes
var node = svg.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(nodes_data)
        .enter()
        .append("circle")
        .attr("r", circleSize)
        .attr("fill", circleColour);
		//attempt at making tag nodes have fixed position at startup
		/*function(d) {
			if (d.level == "0" {
				return ".attr("x", function(d) {return d.x;})\n.attr("y", function(d) {return d.y;})};"
				} else {
				return
				})};*/
		//.append("image")
      	//.attr("xlink:href", "https://github.com/favicon.ico");

var text = svg.append("g")
    .attr("class", "labels")
  .selectAll("text")
    .data(nodes_data)
  .enter().append("text")
	//what if we are not using fixed positions? how to get text to group with corresponding circle?
    .attr("dx", 12)
    .attr("dy", ".35em")
    .text(function(d) { return d.name });	


//draw lines for the links 
var link = svg.append("g")
      .attr("class", "links")
    .selectAll("line")
    .data(links_data)
    .enter().append("line")
      .attr("stroke-width", 2)
      .style("stroke", linkColour);        
                
      
var drag_handler = d3.drag()
	.on("start", drag_start)
	.on("drag", drag_drag)
	.on("end", drag_end);	
	
//same as u	sing .call on the node variable as in https://bl.ocks.org/mbostock/4062045 
drag_handler(node)



/** Functions **/

//Function to choose what color circle we have
//Green: ecological education, blue: human rights, purple: urban planning, red: ecofeminism
//yellow: new media, orange
function circleColour(d){
	if(d.theme =="ecological education"){
		return "green";
	} else if (d.theme =="human rights"){
		return "blue";
	} else if (d.theme =="urban planning"){
		return "purple";
	} else if (d.theme =="ecofeminism"){
		return "red";
	} else if (d.theme =="new media"){
		return "yellow";
	} else if (d.theme =="migration"){
		return "orange";
	}
}
	
//Function to choose what size circle we have
//Let's return 20 for tag nodes and 10 for org nodes
function circleSize(d){
	if(d.level =="0"){
		return 40;
	} else {
		return 20;
	}
}

//Function to choose the line colour and thickness 
//If the link type is "A" return green 
//If the link type is "E" return red 
function linkColour(d){
	if(d.type == "A"){
		return "black";
	} else {
		return "white";
	}
}



//drag handler
//d is the node 
function drag_start(d) {
 if (!d3.event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function drag_drag(d) {
  d.fx = d3.event.x;
  d.fy = d3.event.y;
}


function drag_end(d) {
  if (!d3.event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}
    

    
      
function tickActions() {
    //update circle positions each tick of the simulation 
    node
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });
        
    //update link positions 
    //simply tells one end of the line to follow one node around
    //and the other end of the line to follow the other node around
    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });
	  } 

</script>